<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sprite Labeler</title>
  <style>
    :root {
      color-scheme: light;
      font-family: "Iosevka", "SF Mono", "Menlo", monospace;
      background: #f5f1ea;
      color: #2a2320;
    }
    body {
      margin: 24px;
    }
    header {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 18px;
    }
    button {
      background: #2a2320;
      color: #f5f1ea;
      border: 0;
      padding: 8px 12px;
      cursor: pointer;
    }
    input[type="text"] {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid #b9b1a7;
      border-radius: 4px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 16px;
    }
    .card {
      background: #fffaf2;
      border: 1px solid #d8d0c6;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .card img {
      width: 100%;
      height: auto;
      display: block;
      background: repeating-linear-gradient(
        45deg,
        #eee 0,
        #eee 10px,
        #f7f7f7 10px,
        #f7f7f7 20px
      );
      margin-bottom: 8px;
    }
    .meta {
      font-size: 12px;
      margin-bottom: 6px;
      color: #6b5f57;
    }
  </style>
</head>
<body>
  <header>
    <button id="download">Download labels.json</button>
    <label>
      Load labels.json
      <input id="load" type="file" accept="application/json" />
    </label>
    <span>Open this file directly; images are relative to: assets/atlas/red_samurai</span>
  </header>
  <div class="grid" id="grid"></div>

  <script>
    const records = [{"sheet": "Gemini_Generated_Image_rndjhurndjhurndj.png", "tile_index": 0, "row": 0, "col": 0, "file": "Gemini_Generated_Image_rndjhurndjhurndj__tile_0.png", "label": ""}, {"sheet": "Gemini_Generated_Image_rndjhurndjhurndj.png", "tile_index": 1, "row": 0, "col": 1, "file": "Gemini_Generated_Image_rndjhurndjhurndj__tile_1.png", "label": ""}, {"sheet": "Gemini_Generated_Image_rndjhurndjhurndj.png", "tile_index": 2, "row": 1, "col": 0, "file": "Gemini_Generated_Image_rndjhurndjhurndj__tile_2.png", "label": ""}, {"sheet": "Gemini_Generated_Image_rndjhurndjhurndj.png", "tile_index": 3, "row": 1, "col": 1, "file": "Gemini_Generated_Image_rndjhurndjhurndj__tile_3.png", "label": ""}];
    const grid = document.getElementById("grid");

    function render() {
      grid.innerHTML = "";
      records.forEach((rec, idx) => {
        const card = document.createElement("div");
        card.className = "card";

        const img = document.createElement("img");
        img.src = rec.file;
        img.alt = rec.sheet + " " + rec.tile_index;

        const meta = document.createElement("div");
        meta.className = "meta";
        meta.textContent = `${rec.sheet} | tile ${rec.tile_index} (r${rec.row} c${rec.col})`;

        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "label";
        input.value = rec.label || "";
        input.addEventListener("input", (e) => {
          records[idx].label = e.target.value;
        });

        card.appendChild(img);
        card.appendChild(meta);
        card.appendChild(input);
        grid.appendChild(card);
      });
    }

    document.getElementById("download").addEventListener("click", () => {
      const blob = new Blob([JSON.stringify(records, null, 2)], {type: "application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "labels.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    document.getElementById("load").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        try {
          const loaded = JSON.parse(reader.result);
          const byFile = new Map(loaded.map((r) => [r.file, r]));
          records.forEach((rec) => {
            const match = byFile.get(rec.file);
            if (match && match.label) {
              rec.label = match.label;
            }
          });
          render();
        } catch (err) {
          alert("Failed to load labels.json");
        }
      };
      reader.readAsText(file);
    });

    render();
  </script>
</body>
</html>
